<header class="main-header">

  <!-- ==========================
        DESKTOP HEADER
  =========================== -->
  <div class="header-desktop">
    <!-- TOP BAR -->
    <div class="header-top">
      <!-- Logo -->
      <div class="brand" routerLink="/" (click)="selectBottomMenu('home')">
        <img src="assets/logo/logo.png" alt="Shoppyness" class="logo-desktop" />
      </div>

      <!-- ðŸ“ LOCATION (DESKTOP) -->
      <div class="header-location">
        <i class="bi bi-geo-alt-fill"></i>
        <span class="location-text">
          Current to
          <strong>{{ location.locationData().city || 'Location' }}</strong>
        </span>
      </div>

      <!-- Search -->
      <div class="search-wrapper" (click)="onFocusSearch()">
        <i class="bi bi-search search-icon"></i>

        <input
          type="text"
          class="search-input"
          placeholder="Search for products, brands and more"
          [(ngModel)]="searchQuery"
          (keyup)="onSearchChange()"
          (keyup.enter)="performSearch()"
        />

        @if (isSearchFocused()) {
          <div class="search-dropdown">
            @for (search of searchResults(); track search.id) {
              <div
                class="search-item"
                (click)="openProduct(search.slug); closeSearch()"
              >
                <img [src]="search.images?.[0]?.url" class="search-thumb" />
                <div class="search-info">
                  <div class="title">{{ search.name }}</div>
                 <!-- <div class="sub">
                    {{ search.category }} â€¢ {{ search.subcategory }}
                  </div>-->
                </div>
              </div>
            } 
            @empty {

            <!-- @if (searchResults().length === 0 && searchQuery().length > 1) { -->
              <div class="search-empty">
                No matching products found
              </div>
            }
          </div>
        }
      </div>

      <!-- Right Actions -->
      <div class="actions">

        <!-- USER -->
        <div class="action-item user-area"
             (clickOutside)="toggleUserDropdown.set(false)">
          <button type="button"
                  class="btn-ghost"
                  (click)="toggleUserDropdown.set(!toggleUserDropdown())">
            <i class="bi bi-person-circle"></i>

            <span class="label">
              @if (authService.isLoggedInSignal()) {
                {{ userName() || 'Account' }}
              } @else {
                Login / Signup
              }
            </span>

            <i class="bi bi-chevron-down caret"></i>
          </button>

          @if (toggleUserDropdown()) {
            <div class="user-dropdown">
              @if (authService.isLoggedInSignal()) {
                <div class="user-info">
                  <div class="avatar">
                    {{ (userName() || 'U')[0] | uppercase }}
                  </div>
                  <div>
                    <div class="user-name">{{ userName() }}</div>
                    <div class="muted">Welcome back ðŸ‘‹</div>
                  </div>
                </div>
                <button class="dropdown-item" routerLink="/my-account">
                  My Account
                </button>
                <button class="dropdown-item logout" (click)="logout()">
                  Logout
                </button>
              } @else {
                <button class="dropdown-item" routerLink="/login">Login</button>
                <!--<button class="dropdown-item" routerLink="/login">
                  Create Account
                </button>-->
              }
            </div>
          }
        </div>

        <!-- CART -->
        <div class="action-item cart"
             (click)="selectBottomMenu('cart')">
          <button class="btn-ghost">
            <i class="bi bi-cart3"></i>
            <span class="label">Cart</span>
            @if (cartCount() > 0) {
              <span class="badge">{{ cartCount() }}</span>
            }
          </button>
        </div>

      </div>
    </div>

    <!-- CATEGORY NAV -->
    <div class="header-nav">
      @if (categories().length) {
        <nav class="category-nav">
          <div class="category-item">
              <button class="category-btn" routerLink="/products">
               Show All 
              </button>
          </div>
          @for (cat of categories().slice(0,6); track cat.slug) {
            <div class="category-item"
                 (mouseover)="openMegaMenu(cat)">
              <button class="category-btn"
                      [class.active]="activeCategory() === cat.slug"
                      [routerLink]="['/category', cat.slug]">
                {{ cat.name }}
              </button>

              @if (activeCategory() === cat.slug && cat.subcategories.length) {
                <div class="mega-menu"
                     (mouseleave)="closeMegaMenu()">
                  <div class="mega-column">
                    <div class="mega-links">
                      @for (sub of cat.subcategories; track sub.slug) {
                        <a class="mega-link"
                           [routerLink]="['/category', cat.slug, sub.slug]">
                          {{ sub.name }}
                        </a>
                      }
                    </div>
                  </div>
                </div>
              }
            </div>
          }
        </nav>
      }
    </div>
  </div>

  <!-- ==========================
        MOBILE HEADER
  =========================== -->
  <div class="header-mobile">
    <div class="mobile-top">
      <div class="brand" routerLink="/" (click)="selectBottomMenu('home')">
        <img src="assets/logo/logo.png"
             alt="Shoppyness"
             class="logo-mobile" />
      </div>

      <!-- ðŸ“ LOCATION (MOBILE) -->
      <div class="mobile-location">
        <i class="bi bi-geo-alt-fill"></i>
        <span>{{ location.locationData().city ?? 'location' }}</span>
      </div>

      <div class="mobile-actions">
        <button class="icon-btn"
                routerLink="/cart"
                (click)="selectBottomMenu('cart')">
          <i class="bi bi-cart3"></i>
          @if (cartCount() > 0) {
            <span class="badge">{{ cartCount() }}</span>
          }
        </button>
      </div>
    </div>

    <div class="mobile-search">
      <i class="bi bi-search search-icon"></i>
      <input
        type="text"
        class="search-input"
        placeholder="Search for products, brands and more"
        [(ngModel)]="searchQuery"
        (input)="onSearchChange()"
      />
    </div>

    @if (isSearchFocused()) {
      <div class="mobile-search-dropdown">
        @for (search of searchResults(); track search.id) {
          <div class="search-item"
               (click)="openProduct(search.slug); closeSearch()">
            <img [src]="search.images?.[0]?.url"
                 class="search-thumb" />
            <div class="search-info">
              <div class="title">{{ search.name }}</div>
              <!--<div class="sub">
                {{ search.category }} â€¢ {{ search.subcategory }}
              </div>-->
            </div>
          </div>
        }

        @if (searchResults().length === 0 && searchQuery().length > 1) {
          <div class="search-empty">No product found</div>
        }
      </div>
    }
  </div>

  <!-- ==========================
        MOBILE BOTTOM NAV
  =========================== -->
  <nav class="mobile-bottom-nav">
    <button class="bottom-item" routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
      (click)="selectBottomMenu('home')">
      <i class="bi bi-house-door"></i>
      <span>Home</span>
    </button>
    <button class="bottom-item" routerLink="/categories"
      routerLinkActive="active" (click)="selectBottomMenu('categories')">
      <i class="bi bi-grid"></i>
      <span>Categories</span>
    </button>

    <button class="bottom-item" routerLink="/products" routerLinkActive="active"
      (click)="selectBottomMenu('products')">
      <i class="bi bi-grid"></i>
      <span>Products</span>
    </button>

    <button class="bottom-item" routerLink="/my-account" routerLinkActive="active"
       (click)="selectBottomMenu('my-account')">
      <i class="bi bi-person"></i>
      <span>Account</span>
    </button>
  </nav>

</header>
