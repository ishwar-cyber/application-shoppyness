<nav class="custom-navbar">
  <!-- Top Navbar with Logo, Search, Cart & Login -->
  <div class="navbar-top" (mouseenter)="hideMegaMenu()">
    <!-- Logo for Desktop -->
    <div class="logo-container">
      <a routerLink="/" class="logo-link d-flex align-items-center">
        <svg width="160" height="40" viewBox="0 0 160 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" role="img" aria-label="Shoppyness Technology logo">
          <!-- Transparent background (default) -->
          <title>Shoppyness Technology</title>
      
          <!-- Left: Shopping bag icon (rounded rectangle + handle) -->
          <g transform="translate(6,2)" aria-hidden="true">
            <!-- bag body -->
            <rect class="bag" x="0" y="6" rx="4" ry="4" width="28" height="28"></rect>
            <!-- bag handle (rounded U) -->
            <path class="handle" d="M9 6 a6 6 0 0 1 12 0 v2 h-4v-2 a2 2 0 0 0 -4 0 v2 H9z" transform="translate(0,-2)"></path>
            <!-- S letter inside bag -->
            <text class="bag-s" x="14" y="26" font-size="18" text-anchor="middle" dominant-baseline="middle">S</text>
          </g>

          <!-- Right: Brand text -->
          <!-- "Shoppyness" big -->
          <text class="brand" x="44" y="16" font-size="16" letter-spacing="0.2">Shoppyness</text>

          <!-- "Technology" small and aligned under Shoppyness (slightly to right for visual balance) -->
          <text class="sub" x="44" y="31" font-size="9" letter-spacing="0.15">Technology</text>
        </svg>
      </a>
    </div>
    <div class="search-container">
      <app-search/>
    </div>
    @if(screenWidth() > 400) {
      <div class="cart-login">
        <a routerLink="/cart" class="cart-icon">
          <i class="bi bi-cart3"></i>
          @if(cartService.cartCount()) {
            <span class="cart-count">{{ cartService.cartCount() }}</span>
          } @else {
            <span class="cart-count">0</span>
          }
        </a>
        @if (authService.isLoggedIn()) {
          <div 
            class="user-dropdown" 
            (mouseenter)="toggleUserDropdown.set(true)" 
            (mouseleave)="toggleUserDropdown.set(false)"
          >
            <span class="user-name">{{authService.userName() ? authService.userName() :  userName() }} <i class="bi bi-chevron-down small"></i>
            </span>
            <ul class="dropdown-menu" [class.show]="toggleUserDropdown()">
              <li><button class="dropdown-item btn btn-link" type="button" routerLink="/profile">Profile</button></li>
              <li><button class="dropdown-item btn btn-link" type="button" (click)="logout()">Logout</button> </li>
            </ul>
          </div>
        } @else {
            <a routerLink="/login" class="login-btn"><span class="login-text">Login</span> <i class="bi bi-person"></i></a>
        }
      </div>
    }
  </div>

 <!-- Bottom Navbar with Categories (Desktop Only) -->
<div class="navbar-bottom desktop-only">
  <ul class="nav-menu">
    @for (category of home.categoriesHeader(); track $index) {
      <li class="nav-item" (mouseenter)="showMegaMenu(category.slug)">
        <a routerLink="/products" [queryParams]="{category: category.slug}" class="nav-link">
          {{ category.name }}
          <i class="bi bi-chevron-down small ms-1"></i>
        </a>
      </li>
    }
    <li class="nav-item">
      <a routerLink="/categories" class="nav-link">All Categories</a>
    </li>
  </ul>
  <!-- Mega Menu Dropdown -->
  @if (activeCategory) {
    <div class="mega-menu-container" (mouseenter)="showMegaMenu(activeCategory)" (mouseleave)="hideMegaMenu()">
      <div class="mega-menu-content">
        <div class="mega-menu-grid">
          <!-- Category with Subcategories -->
          @for (category of home.categoriesHeader(); track $index) {
            @if (category.slug === activeCategory) {
              <div class="mega-menu-category">
                <h3 class="mega-menu-title">{{ category.name }}</h3>
                <div class="mega-menu-subcategories">
                  @for (subcategory of category.subcategories; track $index) {
                    <a 
                      class="mega-menu-item"
                      routerLink="/products" 
                      [queryParams]="{ category: category.slug, subcategory: subcategory.slug }" 
                      (click)="hideMegaMenu()"
                    >
                      {{ subcategory.name }}
                    </a>
                  }

                  <!-- View All -->
                  <a 
                    class="mega-menu-item view-all" 
                    routerLink="/products" 
                    [queryParams]="{ category: category.slug }" 
                    (click)="hideMegaMenu()"
                  >
                    View All {{ category.name }} <i class="bi bi-arrow-right"></i>
                  </a>
                </div>
              </div>
            }
          }

          <!-- Featured Products / Promotions -->
          <div class="mega-menu-featured">
            <div class="featured-card">
              <div class="featured-label">FEATURED</div>
              <img 
                src="assets/products/laptop1.jpg" 
                alt="Featured product" 
                loading="lazy" 
                class="featured-image"
              >
              <div class="featured-info">
                <h4>Gaming Laptop</h4>
                <p class="featured-price">â‚¹1,200</p>
                <a 
                  routerLink="/products/1" 
                  class="featured-btn" 
                  (click)="hideMegaMenu()"
                >
                  View Details
                </a>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  }
</div>

  
  <!-- Mobile Bottom Navigation (Fixed at Bottom) -->
  <div class="mobile-navbar mobile-only">
    <a routerLink="/home" class="mobile-nav-item" [class.active]="selectedBottomMenu() === 'home'" (click)="selectBottomMenu('home')">
      <i [class]="selectedBottomMenu() === 'home' ? 'bi bi-house-fill' : 'bi bi-house'"></i>
      <span>Home</span>
    </a>
    <a routerLink="/products" class="mobile-nav-item"  [class.active]="selectedBottomMenu() === 'products'" (click)="selectBottomMenu('products')">
      <i [class]="selectedBottomMenu() === 'products' ? 'bi bi-grid-fill' : 'bi bi-grid'"></i>
      <span>Products</span>
    </a>
    <a routerLink="/categories" class="mobile-nav-item" [class.active]="selectedBottomMenu() === 'categories'" (click)="selectBottomMenu('categories')">
      <i [class]="selectedBottomMenu() === 'categories' ? 'bi bi-grid-3x2-gap-fill' : 'bi bi-grid-3x2-gap'"></i>
      <span>Category</span>
    </a>
    <a routerLink="/cart" class="mobile-nav-item" [class.active]="selectedBottomMenu() === 'cart'" (click)="selectBottomMenu('cart')">
      <i [class]="selectedBottomMenu() === 'cart' ? 'bi bi-cart-fill' : 'bi bi-cart3'"></i>
      <span>Cart</span>
       @if(cartService.cartCount()) {
          <span class="cart-count">{{ cartService.cartCount() }}</span>
        } @else {
          <span class="cart-count">0</span>
        }
    </a>

    @if (authService.isLoggedIn()) {
      <a routerLink="/profile" class="mobile-nav-item"  [class.selected]="selectedBottomMenu() === 'account'">
        <i [class]="selectedBottomMenu() ? 'bi bi-person-fill' : 'bi bi-person'"></i>
        <span>Account</span>
      </a>
      } @else {
        <a routerLink="/login" class="mobile-nav-item"  [class.active]="selectedBottomMenu() === 'account'">
        <i class="bi bi-person"></i>
        <span>Account</span>
      </a>
    }
  </div>
</nav>
