<header class="main-header">

  <!-- ==========================
        DESKTOP HEADER
  =========================== -->
  @if (!isMobileView()) {

    <div class="header-desktop">

      <!-- TOP BAR -->
      <div class="header-top">

        <!-- Logo -->
        <div class="brand"
             routerLink="/"
             (click)="selectBottomMenu('home')">
          <span class="brand-mark">S</span>
          <span class="brand-text">Shoppyness</span>
        </div>

        <!-- Search -->
       <!-- Search -->
<div class="search-wrapper" (click)="onFocusSearch()">

  <i class="bi bi-search search-icon"></i>

  <input
    type="text"
    class="search-input"
    placeholder="Search for products, brands and more"
    [(ngModel)]="searchQuery"
    (keyup)="onSearchChange()"
    (keyup.enter)="performSearch()"
    (focus)="isSearchFocused.set(true)"
  />

  <!-- ðŸ” SEARCH DROPDOWN -->
  @if (isSearchFocused() && searchResults().length > 0) {
    <div class="search-dropdown">

      @for (item of searchResults(); track item._id) {
        <div class="search-item" (click)="openProduct(item.slug)">
          <img [src]="item.images?.[0]?.url" class="search-thumb" />

          <div class="search-info">
            <div class="title">{{ item.name }}</div>
            <div class="sub">{{ item.category }} â€¢ {{ item.subcategory }}</div>
          </div>
        </div>
      }

    </div>
  }

  <!-- ðŸ” No results -->
  @if (isSearchFocused() && searchQuery().length > 1 && searchResults().length == 0) {
    <div class="search-dropdown empty">
      <p>No matching products found</p>
    </div>
  }

</div>


        <!-- Right Actions -->
        <div class="actions">

          <!-- USER -->
          <div class="action-item user-area"
               (clickOutside)="toggleUserDropdown.set(false)">

            <button type="button"
                    class="btn-ghost"
                    (click)="toggleUserDropdown.set(!toggleUserDropdown())">
              <i class="bi bi-person-circle"></i>

              <span class="label">
                @if (authService.isLoggedInSignal()) {
                  {{ userName() || 'Account' }}
                } @else {
                  Login / Signup
                }
              </span>

              <i class="bi bi-chevron-down caret"></i>
            </button>

            <!-- User Dropdown -->
            @if (toggleUserDropdown()) {
              <div class="user-dropdown">

                @if (authService.isLoggedInSignal()) {

                  <div class="user-info">
                    <div class="avatar">
                      {{ (userName() || 'U')[0] | uppercase }}
                    </div>
                    <div>
                      <div class="user-name">{{ userName() }}</div>
                      <div class="muted">Welcome back ðŸ‘‹</div>
                    </div>
                  </div>

                  <button class="dropdown-item" routerLink="/my-account">
                    My Account
                  </button>

                  <!-- <button class="dropdown-item" routerLink="/orders">
                    My Orders
                  </button> -->

                  <button class="dropdown-item logout" (click)="logout()">
                    Logout
                  </button>

                } @else {

                  <button class="dropdown-item" routerLink="/login">Login</button>
                  <button class="dropdown-item" routerLink="/register">Create Account</button>

                }

              </div>
            }
          </div>

          <!-- CART -->
          <div class="action-item cart"
               routerLink="/cart"
               (click)="selectBottomMenu('cart')">

            <button class="btn-ghost">
              <i class="bi bi-cart3"></i>

              <span class="label">Cart</span>

              @if (cartCount() > 0) {
                <span class="badge">{{ cartCount() }}</span>
              }
            </button>
          </div>

        </div>
      </div>

      <!-- =======================
           CATEGORY NAV + MEGAMENU
      ======================= -->
      <div class="header-nav">
        @if (categories().length) {
          <nav class="category-nav">

            @for (cat of categories(); track cat.slug) {
              <div class="category-item" (mouseover)="openMegaMenu(cat)" >
                <button class="category-btn"
                        [class.active]="activeCategory() === cat.slug"
                        [routerLink]="['/category', cat.slug]">
                  {{ cat.name }}
                </button>

                <!-- MEGA MENU -->
                @if (activeCategory() === cat.slug && cat.subcategories.length) {

                  <div class="mega-menu"  (mouseleave)="closeMegaMenu()">
                    <div class="mega-column">
                      <!-- <h4 class="mega-title">{{ cat.name }}</h4> -->

                      <div class="mega-links">
                        @for (sub of cat.subcategories; track sub.slug) {
                          <a class="mega-link"
                             [routerLink]="['/category', cat.slug, sub.slug]">
                            {{ sub.name }}
                          </a>
                        }
                      </div>

                    </div>
                  </div>

                }
              </div>

            }

          </nav>
        }
      </div>

    </div>

  }


  <!-- ==========================
        MOBILE HEADER
  =========================== -->
  @if (isMobileView()) {
    <div class="header-mobile">
      <div class="mobile-top">
        <div class="brand" routerLink="/" (click)="selectBottomMenu('home')">
          <span class="brand-mark">S</span>
          <span class="brand-text">Shoppyness</span>
        </div>

        <div class="mobile-actions">
          <!-- <button class="icon-btn">
            <i class="bi bi-search"></i>
          </button> -->
          <button class="icon-btn"
                  routerLink="/cart"
                  (click)="selectBottomMenu('cart')">
            <i class="bi bi-cart3"></i>
            @if (cartCount() > 0) {
              <span class="badge">{{ cartCount() }}</span>
            }
          </button>
        </div>
      </div>
      <div class="mobile-search">
        <i class="bi bi-search search-icon"></i>
       <input
            type="text"
            class="search-input"
            placeholder="Search for products, brands and more"
            [(ngModel)]="searchQuery"
            (keyup)="onSearchChange()"
            (keyup.enter)="performSearch()"
            (focus)="isSearchFocused.set(true)"
          />
      </div>
      @if (isSearchFocused() && searchResults().length > 0) {
        <div class="mobile-search-dropdown">

          @for (item of searchResults(); track item._id) {
            <div class="search-item" (click)="openProduct(item.slug); isSearchFocused.set(false); searchQuery.set('')">
              <img [src]="item.images?.[0]?.url" class="search-thumb" />

              <div class="search-info">
                <div class="title">{{ item.name }}</div>
                <div class="sub">{{ item.category }} â€¢ {{ item.subcategory }}</div>
              </div>
            </div>
          }

        </div>
      }

    </div>

  }


  <!-- MOBILE BOTTOM NAV -->
  @if (isMobileView()) {

    <nav class="mobile-bottom-nav">

      <button class="bottom-item"
              [class.active]="selectedBottomMenu() === 'home'"
              (click)="selectBottomMenu('home')"
              routerLink="/">
        <i class="bi bi-house-door"></i>
        <span>Home</span>
      </button>

      <button class="bottom-item"
              [class.active]="selectedBottomMenu() === 'categories'"
              routerLink="/categories"
              (click)="selectBottomMenu('categories')">
        <i class="bi bi-grid"></i>
        <span>Categories</span>
      </button>

      <button class="bottom-item"
              [class.active]="selectedBottomMenu() === 'products'"
              routerLink="/products"
              (click)="selectBottomMenu('products')">
        <i class="bi bi-grid"></i>
        <span>Products</span>
      </button>

      <!-- <button class="bottom-item"
              [class.active]="selectedBottomMenu() === 'cart'"
              routerLink="/cart"
              (click)="selectBottomMenu('cart')">
        <i class="bi bi-cart3"></i>
        <span>Cart</span>
      </button> -->

      <button class="bottom-item"
              [class.active]="selectedBottomMenu() === 'my-account'"
              routerLink="/my-account"
              (click)="selectBottomMenu('my-account')">
        <i class="bi bi-person"></i>
        <span>Account</span>
      </button>

    </nav>

  }

</header>
