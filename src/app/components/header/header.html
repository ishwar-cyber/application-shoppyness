<nav class="custom-navbar">
  <!-- Top Navbar with Logo, Search, Cart & Login -->
  <div class="navbar-top" (mouseenter)="hideMegaMenu()">
    <!-- Logo for Desktop -->
    <div class="logo-container desktop-only ">
      <a routerLink="/" class="logo-link d-flex flex-column column-gap-0">
        <!-- <img src="assets/images/logo.svg" alt="shoppyness Logo" class="logo-image"> -->
         <h5 class="p-0 m-0">SHOPPYNESS</h5><br>
         <h6 class="p-0">TECHNOLOGY</h6>
      </a>
    </div>
    <div class="search-container">
      <app-search/>
    </div>
    @if(!isMobileView()) {
    <div class="cart-login">
      <a routerLink="/cart" class="cart-icon">
        <i class="bi bi-cart3"></i>
        @if(cartService.cartCount()) {
          <span class="cart-count">{{ cartService.cartCount() }}</span>
        } @else {
          <span class="cart-count">0</span>
        }
      </a>
      @if (authService.isLoggedIn()) {
      <div 
        class="user-dropdown" 
        (mouseenter)="toggleUserDropdown.set(true)" 
        (mouseleave)="toggleUserDropdown.set(false)"
      >
        <span class="user-name">{{authService.userName() ? authService.userName() :  userName() }} <i class="bi bi-chevron-down small"></i>
        </span>
        <ul class="dropdown-menu" [class.show]="toggleUserDropdown()">
          <li><a class="dropdown-item" routerLink="/profile">Profile</a></li>
          <li><a class="dropdown-item" href="" (click)="logout()">Logout</a></li>
        </ul>
      </div>
      } @else {
        <a routerLink="/login" class="login-btn">
          <span class="login-text">Login</span>
          <i class="bi bi-person"></i>
        </a>
}
    </div>
    }
  </div>
  
  <!-- Bottom Navbar with Categories (Desktop Only) -->
  <div class="navbar-bottom desktop-only">
    <ul class="nav-menu">
      <li class="nav-item" 
          *ngFor="let category of categories" 
          (mouseenter)="showMegaMenu(category.slug)">
        <a routerLink="/products" [queryParams]="{category: category.slug}" class="nav-link">
          {{ category.name }}
          <i class="bi bi-chevron-down small ms-1"></i>
        </a>
      </li>
      <li class="nav-item">
        <a routerLink="/products" class="nav-link">All Products</a>
      </li>
    </ul>
    
    <!-- Mega Menu Dropdown -->
     @if(activeCategory){
          <div class="mega-menu-container" (mouseenter)="showMegaMenu(activeCategory)"  (mouseleave)="hideMegaMenu()">
          <div class="mega-menu-content">
            <div class="mega-menu-grid">
              @for (category of categories; track $index) {
                <ng-container>
                  @if(category.slug === activeCategory){
                  <div class="mega-menu-category">
                    <h3 class="mega-menu-title">{{ category.name }}</h3>
                    <div class="mega-menu-subcategories">
                      @for (subcategory of category.subcategories; track $index) {
                        <a 
                          class="mega-menu-item"
                          routerLink="/products" 
                          [queryParams]="{category: category.slug, subcategory: subcategory.slug}" 
                          (click)="hideMegaMenu()">
                          {{ subcategory.name }}
                        </a>
                      }
                      <a class="mega-menu-item view-all" 
                        routerLink="/products" 
                        [queryParams]="{category: category.slug}" 
                        (click)="hideMegaMenu()">
                        View All {{ category.name }} <i class="bi bi-arrow-right"></i>
                      </a>
                    </div>
                  </div>
                }
                </ng-container>
              }
              <!-- Featured Products or Promotions -->
              <div class="mega-menu-featured">
                <div class="featured-card">
                  <div class="featured-label">FEATURED</div>
                  <img src="assets/products/laptop1.jpg" alt="Featured product" class="featured-image">
                  <div class="featured-info">
                    <h4>Gaming Laptop</h4>
                    <p class="featured-price">â‚¹1,200</p>
                    <a routerLink="/products/1" class="featured-btn" (click)="hideMegaMenu()">View Details</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
     }
  
  </div>
  
  <!-- Mobile Bottom Navigation (Fixed at Bottom) -->
  <div class="mobile-navbar mobile-only">
    <a routerLink="/home" class="mobile-nav-item" [class.active]="selectBottomMenu('home')">
      <i class="bi bi-house"></i>
      <span>Home</span>
    </a>
    <a routerLink="/products" class="mobile-nav-item"  [class.active]="selectBottomMenu( 'products')">
      <i class="bi bi-grid"></i>
      <span>Products</span>
    </a>
    <a routerLink="/cart" class="mobile-nav-item" [class.active]="selectBottomMenu('cart')">
      <i class="bi bi-cart3"></i>
      <span>Cart</span>
       @if(cartService.cartCount()) {
          <span class="cart-count">{{ cartService.cartCount() }}</span>
        } @else {
          <span class="cart-count">0</span>
        }
    </a>

     @if (authService.isLoggedIn()) {
      <div 
        class="user-dropdown" 
        (mouseenter)="toggleUserDropdown.set(true)" 
        (mouseleave)="toggleUserDropdown.set(false)"
      >
        <span class="user-name">{{authService.userName() ? authService.userName() :  userName() }} <i class="bi bi-chevron-down small"></i>
        </span>
        <ul class="dropdown-menu" [class.show]="toggleUserDropdown()">
          <li><a class="dropdown-item" routerLink="/profile">Profile</a></li>
          <li><a class="dropdown-item" (click)="logout()">Logout</a></li>
        </ul>
      </div>
      } @else {
        <a routerLink="/login" class="login-btn">
          <span class="login-text">Login</span>
          <i class="bi bi-person"></i>
        </a>
}
  </div>
</nav>
