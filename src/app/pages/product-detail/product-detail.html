@if(product()){
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
        <li class="breadcrumb-item"><a routerLink="/products">Products</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ product()?.name }}</li>
        </ol>
    </nav>
    <div class="row" itemscope>
        <meta itemprop="sku" [content]="product()?.sku" />
        <meta itemprop="mpn" [content]="product()?.id" />

        <!-- Product Images - Left Column -->
        <div class="col-md-6 mb-4">
        <div class="product-image-container">
            <div class="main-image-wrapper">
                @if((product()?.images?.length ?? 0) > 1) {
                    <button class="image-nav-btn prev-btn" (click)="prevImage()" aria-label="Previous image">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                }
                <img [src]="selectedImage" 
                    [alt]="product()?.name" 
                    class="img-fluid product-image" 
                    itemprop="image" 
                    loading="eager" />
              @if((product()?.images?.length ?? 0) > 1) {
                    <button class="image-nav-btn next-btn" (click)="nextImage()" aria-label="Next image">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                }
            </div>
            @if((product()?.images?.length ?? 0) > 1) {
                <div class="thumbnail-gallery">
                    @for (img of product()?.images; track $index) {
                        <button 
                            class="thumbnail-item" 
                            [class.active]="selectedImageIndex() === $index"
                            (click)="selectImage($index)"
                            [attr.aria-label]="'View image ' + ($index + 1)"
                        >
                            <img [src]="img.url" 
                                [alt]="product()!.name + ' thumbnail ' + ($index + 1)" 
                                class="img-fluid" 
                                loading="lazy" />
                        </button>
                    }
                </div>
            }
        </div>
        </div>

        <!-- Product Details - Right Column -->
        <div class="col-md-6">
            <h1 class="product-title text-truncate" data-bs-target="tooltip" itemprop="name">{{ product()!.name }}</h1>
            <p class="product-brand text-muted" itemprop="brand">
            
                <span class="fw-bold">Brand:</span> {{ product()!.brand.name }}
            </p>
            <p class="product-sku text-muted">
                <span class="fw-bold">SKU:</span> {{ product()!.sku }}
            </p>
            <div class="product-price mb-3 d-flex align-items-center" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
            <meta itemprop="priceCurrency" content="INR" />
            <span class="price-tag" itemprop="price">â‚¹ {{ product()?.price }}</span>
            @if((product()?.stock ?? 0) > 0){
                <span class="badge bg-success ms-2">In Stock</span>
            } @else if ((product()?.stock ?? 0) <= 0) {
                <span class="badge bg-danger ms-2">Out of Stock</span>
            }
        </div>

        <!-- Check Delivery Availability -->
        <app-check-pincode/>

        @if(product()?.variants && product()?.variants?.length > 0){
             <div class="product-variant mt-4">
                <h2 class="h5">Available Varaint</h2>
                <div class="row">
                    @for (variant of product()?.variants; track $index) {
                        <div class="col-6 col-md-6 mb-3" >
                            <div class="card h-100"  [class.selected]="selectedVaraint() === variant.name" (click)="selectVariant(variant)">
                                <div class="card-body">
                                    <h5 class="card-title">{{variant.name}}</h5>
                                    <p class="card-text">{{variant.price}}</p>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
        <div class="product-actions">
            <!-- <div class="quantity-controls mb-3">
                  @if ((product()?.stock ?? 0 ) > 0) {
                    <div class="d-flex align-items-center">
                        <button class="btn btn-outline-secondary" 
                                (click)="cartService.updateQuantity(product()!.id, -1)" 
                                [disabled]="quantity() <= 1" 
                                aria-label="Decrease quantity">
                        <i class="bi bi-dash"></i>
                        </button>
                        <span class="quantity-display mx-3">{{ quantity() }}</span>
                        <button class="btn btn-outline-secondary" 
                                (click)="cartService.updateQuantity(product()!.id, 1)" 
                                [disabled]="quantity() >= (product()?.stock ?? 0)" 
                                aria-label="Increase quantity">
                        <i class="bi bi-plus"></i>
                        </button>
                        @if ((product()?.stock ?? 0) < 10) {
                            <span class="text-muted ms-3" >Only {{ product()?.stock }} left in stock</span>
                        }
                        
                    </div>
                }
            </div> -->
            <div class="d-flex flex-wrap">
            <button class="btn btn-primary btn-lg  mb-2" 
                    (click)="addToCart(product())" 
                    [disabled]="isAddingToCart() || (product()?.stock ?? 0) <= 0">
                @if(!isAddingToCart()){
                  <span><i class="bi bi-cart-plus me-2"></i>Add to Cart </span>
                }
                @if(isAddingToCart()){
                  <span><i class="bi bi-arrow-repeat spin me-2"></i>Adding... </span>
                }
                
            </button>
            <button class="btn btn-outline-secondary btn-lg mb-2">
                <i class="bi bi-heart me-2"></i>Add to Wishlist
            </button>
            </div>
            
            <!-- Success Message -->
             @if(addedToCartMessage()){
                <div class="alert alert-success mt-3" >
                    <i class="bi bi-check-circle me-2"></i>{{ addedToCartMessage() }}
                </div>
             }
            
        </div>
        </div>
    </div>
    <!-- Product Details Tabs -->
    <div class="product-details-tabs mt-4">
      <ul class="nav nav-tabs" id="productDetailsTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button 
            class="nav-link active fw-bolder" 
            id="description-tab" 
            data-bs-toggle="tab" 
            data-bs-target="#description"
            type="button" 
            role="tab" 
            aria-controls="description" 
            aria-selected="true">
            Description
          </button>
        </li>

        @if (product()?.specifications?.length > 0) {
          <li class="nav-item" role="presentation">
            <button 
              class="nav-link fw-bolder" 
              id="specifications-tab" 
              data-bs-toggle="tab" 
              data-bs-target="#specifications"
              type="button" 
              role="tab" 
              aria-controls="specifications" 
              aria-selected="false">
              Specifications
            </button>
          </li>
        }
      </ul>

      <div class="tab-content p-3 border border-top-0 rounded-bottom" id="productDetailsTabContent">
        <!-- Description -->
        <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">
          <p>{{ product()?.description }}</p>
        </div>
        
        <!-- Specifications -->
        <div class="tab-pane fade" id="specifications" role="tabpanel" aria-labelledby="specifications-tab">
          <ul class="list-group">
            @for (item of product()?.specifications; track $index) {
              <li class="list-group-item d-flex justify-content-between">
                <span class="fw-bold">{{ item.name }}</span>
                <span>{{ item.value }}</span>
              </li>
            }
          </ul>
        </div>
      </div>
    </div>
    <!-- Related Products Section -->
    @if(relatedProducts().length > 0){
        <section class="related-products mt-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-4">Related Products</h2>
                <div class="scroll-controls">
                    <button class="btn btn-outline-secondary me-2 scroll-btn" (click)="scrollProducts('left')">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                     <button class="btn btn-outline-secondary me-2 scroll-btn"  (click)="scrollProducts('right')">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
            </div>
            <div class="related-products-scroll-container">
                <div class="related-products-scroll" #relatedProductsScroll>
                    @for (productItem of relatedProducts(); track $index) {
                      
                        <div class="related-product-card">
                            <app-product-card [product]="productItem"></app-product-card>
                        </div>
                    }
                </div>
            </div>
        </section>
    }
</div>
} @else {
    <!-- Load   ing State -->
    <div class="container mt-5 text-center">
    <div class="d-flex justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" aria-hidden="true">
        <span class="visually-hidden">Loading product details...</span>
        </div>
    </div>
    <p class="mt-3" aria-live="polite">Loading product details...</p>
    </div>
}
<!-- Not Found State -->
 @if(!product() && !loading() && !error()){
  <div class="container mt-4 text-center">
  <div class="alert alert-warning">
    <h2>Product Not Found</h2>
    <p>Sorry, the product you are looking for does not exist or has been removed.</p>
    <a routerLink="/products" class="btn btn-primary mt-3">Browse All Products</a>
  </div>
</div>
 }