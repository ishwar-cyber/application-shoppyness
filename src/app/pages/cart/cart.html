<div class="cart-desktop">

  <!-- 1️⃣ LOADING -->
  @if (loading()) {
    <div class="cart-skeleton">
      <!-- LEFT -->
      <section class="cart-skeleton-items">
        <div class="sk sk-title"></div>

        <article class="cart-skeleton-item">
          <div class="sk sk-img"></div>
          <div class="item-info">
            <div class="sk sk-name"></div>
            <div class="sk sk-meta"></div>
            <div class="sk sk-price"></div>

            <div class="qty-skeleton">
              <div class="sk sk-btn"></div>
              <div class="sk sk-qty"></div>
              <div class="sk sk-btn"></div>
            </div>

            <div class="sk sk-remove"></div>
          </div>
        </article>
      </section>

      <!-- RIGHT -->
      <aside class="cart-skeleton-summary">
        <div class="sk sk-summary-title"></div>

        <div class="summary-row">
          <div class="sk sk-line"></div>
          <div class="sk sk-value"></div>
        </div>

        <div class="summary-row total">
          <div class="sk sk-line"></div>
          <div class="sk sk-value"></div>
        </div>

        <div class="sk sk-checkout"></div>
      </aside>
    </div>
  }

  <!-- 2️⃣ EMPTY CART -->
  @else if (!hasItems()) {
    <div class="empty-cart-modern">
      <div class="empty-box">
        <img src="assets/empty-cart.svg" class="empty-img" />

        <h2 class="heading">Your Cart is Empty</h2>
        <p class="subtext">Add items to your cart to continue shopping.</p>

        <button routerLink="/products" class="btn-primary start-btn">
          Browse Products
        </button>
      </div>
    </div>
  }

  <!-- 3️⃣ CART WITH ITEMS -->
  @else {
    <div class="cart-left">
      <h2 class="page-title">Shopping Cart</h2>

      @for (item of cartItems(); track item.id) {
        <div class="cart-item-modern">
          <div class="details">

            <div class="product">
              <div class="cart-image">
                <img
                  width="90"
                  [src]="item?.images?.[0]?.url || 'assets/no-image.png'"
                  [alt]="item.name"
                  loading="lazy"
                />
              </div>

              <h3 class="name">{{ item.name }}</h3>
              <p class="price">₹{{ item.price }}</p>
            </div>

            <div class="qty_remove">
              <div class="qty-row">
                <button
                  class="qty-btn"
                  (click)="cartService.updateQuantity(item.id, item.quantity - 1)"
                  [disabled]="item.quantity === 1">
                  -
                </button>

                <span class="qty">{{ item.quantity }}</span>

                <button
                  class="qty-btn"
                  (click)="cartService.updateQuantity(item.id, item.quantity + 1)">
                  +
                </button>
              </div>

              <button class="remove-btn" (click)="removeItem(item.id)">
                <i class="bi bi-trash"></i> Remove
              </button>
            </div>

          </div>
        </div>
      }
    </div>

    <!-- SUMMARY -->
    <div class="cart-right">
      <div class="summary-box sticky">
        <h3 class="summary-title">Price Summary</h3>

        <div class="cart_summary">
          <span>Subtotal</span>
          <strong>₹ {{ cartService.subTotal() }}</strong>
        </div>

        <div class="cart_summary">
          <span>Shipping</span>
          <strong>₹ {{ cartService.getShippingCharge() }}</strong>
        </div>

        <div class="cart_summary total">
          <span>Total</span>
          <strong>₹ {{ cartService.totalPrice() }}</strong>
        </div>

        <button class="btn-primary checkout-btn" (click)="checkout()">
          Proceed to Checkout
        </button>

        <button class="clear-btn" (click)="clearCart()">
          Clear Cart
        </button>
      </div>
    </div>
  }

</div>

<!-- ✅ GLOBAL LOADER (API ACTIONS ONLY) -->
@if (cartService.isLoader()) {
  <app-loader />
}
